import{Q as i}from"./QCardSection.716535fd.js";import{Q as b}from"./QSeparator.e84d2063.js";import{Q as k}from"./QIcon.ea5b446d.js";import{Q as y}from"./QInput.ed0871c6.js";import{Q as s}from"./QBtn.0cd3b6d8.js";import{Q as A,a as m}from"./QTable.47344d01.js";import{Q as C}from"./QPagination.a2971530.js";import{Q as D}from"./QSelect.708c060d.js";import{Q as c}from"./QCard.b7e4e1a0.js";import{Q as u}from"./QDialog.4ef26000.js";import{Q as U}from"./QPage.2d416ccc.js";import{a as d}from"./axios.ab682c6b.js";import{_ as v,j as Q,k as f,v as g,m as a,d as t,s as T,t as V,u as n,p as r}from"./index.736ad444.js";import"./render.6912de76.js";import"./use-dark.e1720bdb.js";import"./use-key-composition.9e2822db.js";import"./QSpinner.c748c914.js";import"./use-id.6ea4b0d3.js";import"./focus-manager.7cc6c8df.js";import"./dom.1e4b93b2.js";import"./QList.7895aa30.js";import"./QMarkupTable.b114800e.js";import"./scroll.fccc1b7a.js";import"./QCheckbox.6814ad40.js";import"./format.2cae61da.js";import"./QChip.81ee8217.js";import"./QItem.8d4a3ee9.js";import"./QItemLabel.49cb5c0e.js";import"./position-engine.d6b923eb.js";import"./selection.f6b17ade.js";import"./use-portal.cabefa8e.js";import"./use-tick.a3aa914c.js";import"./use-timeout.5f9e01c3.js";import"./rtl.276c3f1b.js";import"./use-prevent-scroll.a2c30d89.js";const p="https://backend.parkease.online/api",S=Q({name:"TableBasic",data(){return{filter:"",show_filter:!1,users:[],loading:!1,deleteDialog:!1,acceptDialog:!1,userToAccept:null,userToDelete:null,rowsPerPageOptions:[5,10],pagination:{rowsPerPage:10,page:1},totalPages:0,columns:[{name:"id",label:"ID",align:"left",field:"id",sortable:!0},{name:"first_name",label:"School Name",align:"left",field:"first_name",sortable:!0},{name:"middle_name",label:"School Number",align:"left",field:"middle_name",sortable:!0},{name:"last_name",label:"Assigned Personnel Full Name",align:"left",field:"last_name",sortable:!0},{name:"email",label:"Email",align:"left",field:"email",sortable:!0},{name:"account_type",label:"Account Type",align:"left",field:"account_type",sortable:!0},{name:"action",label:"Actions",align:"center",field:"action"}],accountTypeOptions:[{label:"Developer",value:1},{label:"Admin",value:2},{label:"Admin Workers",value:3},{label:"School",value:4},{label:"School",value:5},{label:"School",value:6}]}},created(){const e="https://realtime.parkease.online";this.socket=io(e),this.socket.on("receiverTriggerness",(o,h)=>{o=="WeHaveANewSignUpAccount"&&this.fetchUsers()})},computed:{filteredUsers(){return this.filter?this.users.filter(e=>e.first_name.toLowerCase().includes(this.filter.toLowerCase())||e.last_name.toLowerCase().includes(this.filter.toLowerCase())||e.email.toLowerCase().includes(this.filter.toLowerCase())):this.users}},methods:{getAccountTypeName(e){return{1:"Developer",5:"School",6:"School"}[e]||"Unknown"},async fetchUsers(){this.loading=!0;try{const e=localStorage.getItem("access_token"),o=await d.get(`${p}/notValidUsers`,{headers:{Authorization:`Bearer ${e}`},params:{search:this.filter,per_page:this.pagination.rowsPerPage,page:this.pagination.page}});this.users=o.data.data,this.totalPages=o.data.last_page}catch(e){console.error(e)}finally{this.loading=!1}},toggleFilter(){this.show_filter=!this.show_filter},async openEditModal(e){this.editForm={...e},this.editDialog=!0},async confirmDelete(e){this.userToDelete=e,this.deleteDialog=!0},async deleteUser(){try{const e=localStorage.getItem("access_token");await d.delete(`${p}/validUsers/${this.userToDelete.id}`,{headers:{Authorization:`Bearer ${e}`}}),this.deleteDialog=!1,this.fetchUsers(),this.triggerSocketToAdmin("WeHaveANewSignUpAccount")}catch(e){console.error(e)}},triggerSocketToAdmin(e){this.socket.emit("senderTriggerness",e,552)},async confirmAccept(e){this.userToAccept=e,this.acceptDialog=!0},async acceptConfirmedUser(){try{const e=localStorage.getItem("access_token");(await d.post(`${p}/acceptAccount`,{id:this.userToAccept.id},{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})).status===200&&(this.fetchUsers(),this.triggerSocketToAdmin("WeHaveANewSignUpAccount"))}catch(e){console.error(e)}finally{this.acceptDialog=!1}},closeAcceptDialog(){this.acceptDialog=!1},closeDeleteDialog(){this.deleteDialog=!1}},mounted(){this.fetchUsers()}}),_=r("div",{class:"text-h6"},"Pending Users",-1),P={style:{display:"flex","justify-content":"space-between",padding:"10px"}},$=r("div",{class:"text-h6"},"Confirm Delete",-1),N=r("p",null,"Are you sure you want to delete this user?",-1),q=r("div",{class:"text-h6"},"Confirm Accept",-1);function B(e,o,h,I,L,j){return f(),g(U,{padding:""},{default:a(()=>[t(c,{class:"no-shadow",bordered:""},{default:a(()=>[t(i,{class:"header-format-w"},{default:a(()=>[_]),_:1}),t(b),t(i,{class:"q-pa-none"},{default:a(()=>[t(A,{square:"",class:"no-shadow",title:"Users",rows:e.filteredUsers,columns:e.columns,"row-key":"id",filter:e.filter,pagination:e.pagination,"hide-pagination":""},{"top-right":a(()=>[e.show_filter?(f(),g(y,{key:0,filled:"",borderless:"",dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":o[0]||(o[0]=l=>e.filter=l),placeholder:"Search"},{append:a(()=>[t(k,{name:"search"})]),_:1},8,["modelValue"])):T("",!0),t(s,{class:"q-ml-sm",icon:"filter_list",onClick:e.toggleFilter,flat:""},null,8,["onClick"])]),"body-cell-action":a(l=>[t(m,{props:l,class:"q-pa-md q-gutter-sm"},{default:a(()=>[t(s,{label:"Accept",onClick:w=>e.confirmAccept(l.row),color:"secondary"},null,8,["onClick"]),t(s,{label:"Reject",onClick:w=>e.confirmDelete(l.row),color:"negative"},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-account_type":a(l=>[t(m,{props:l},{default:a(()=>[V(n(e.getAccountTypeName(l.row.account_type)),1)]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter","pagination"]),r("div",P,[t(C,{modelValue:e.pagination.page,"onUpdate:modelValue":[o[1]||(o[1]=l=>e.pagination.page=l),e.fetchUsers],max:e.totalPages,"boundary-numbers":"",class:"q-mt-md"},null,8,["modelValue","max","onUpdate:modelValue"]),t(D,{filled:"",modelValue:e.pagination.rowsPerPage,"onUpdate:modelValue":[o[2]||(o[2]=l=>e.pagination.rowsPerPage=l),e.fetchUsers],options:e.rowsPerPageOptions,label:"Rows per page",class:"q-ml-sm",dense:"",style:{width:"200px"}},null,8,["modelValue","options","onUpdate:modelValue"])])]),_:1})]),_:1}),t(u,{modelValue:e.deleteDialog,"onUpdate:modelValue":o[3]||(o[3]=l=>e.deleteDialog=l)},{default:a(()=>[t(c,null,{default:a(()=>[t(i,{class:"header-format-w"},{default:a(()=>[$,N]),_:1}),t(i,null,{default:a(()=>[t(s,{label:"Delete",color:"negative",onClick:e.deleteUser},null,8,["onClick"]),t(s,{label:"Cancel",class:"q-ml-sm",onClick:e.closeDeleteDialog},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(u,{modelValue:e.acceptDialog,"onUpdate:modelValue":o[4]||(o[4]=l=>e.acceptDialog=l)},{default:a(()=>[t(c,null,{default:a(()=>[t(i,{class:"header-format-w"},{default:a(()=>[q,r("p",null,"Are you sure you want to accept "+n(e.userToAccept.first_name)+" "+n(e.userToAccept.middle_name)+" "+n(e.userToAccept.last_name)+"?",1)]),_:1}),t(i,null,{default:a(()=>[t(s,{label:"Accept",color:"secondary",onClick:e.acceptConfirmedUser},null,8,["onClick"]),t(s,{label:"Cancel",class:"q-ml-sm",onClick:e.closeAcceptDialog},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var ye=v(S,[["render",B]]);export{ye as default};
