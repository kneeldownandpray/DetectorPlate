import{Q as i}from"./QCardSection.d27bd26a.js";import{Q as w}from"./QSeparator.1b7512a0.js";import{Q as b}from"./QIcon.6a1c506e.js";import{Q as y}from"./QInput.62618fbe.js";import{Q as s}from"./QBtn.ff85a6ff.js";import{Q as d}from"./QTd.5a66afdc.js";import{Q as A}from"./QTable.9d9784b4.js";import{Q as k}from"./QPagination.edf7b580.js";import{Q as C}from"./QSelect.71279283.js";import{Q as c}from"./QCard.c79eb86a.js";import{Q as u}from"./QDialog.c9516741.js";import{Q as D}from"./QPage.cd4eeac7.js";import{a as m}from"./axios.ab682c6b.js";import{_ as U,j as Q,k as f,v as g,m as o,d as t,s as T,t as V,u as n,p as r}from"./index.ccc655a8.js";import"./render.31dc14a1.js";import"./use-dark.fcf957f9.js";import"./use-size.e5fcccbb.js";import"./use-key-composition.b73995f7.js";import"./QSpinner.ad1652ab.js";import"./use-id.51f80acb.js";import"./uid.937d8ee7.js";import"./focus-manager.7cc6c8df.js";import"./private.use-form.bf143076.js";import"./dom.ab32582f.js";import"./use-router-link.f3c58062.js";import"./vm.bd5b438f.js";import"./QList.3fa3315d.js";import"./QMarkupTable.7a11d5f7.js";import"./scroll.3a45a3c7.js";import"./QCheckbox.5aa928a9.js";import"./format.2cae61da.js";import"./QChip.44a8527b.js";import"./QItem.79ca4c2d.js";import"./QItemLabel.c51f45b8.js";import"./position-engine.e628e528.js";import"./selection.1b9d0d65.js";import"./use-portal.887f479b.js";import"./use-tick.280905b1.js";import"./use-timeout.1142a48a.js";import"./rtl.276c3f1b.js";import"./use-prevent-scroll.89277a0f.js";const p="https://backend.parkease.online/api",v=Q({name:"TableBasic",data(){return{filter:"",show_filter:!1,users:[],loading:!1,deleteDialog:!1,acceptDialog:!1,userToAccept:null,userToDelete:null,rowsPerPageOptions:[5,10],pagination:{rowsPerPage:10,page:1},totalPages:0,columns:[{name:"id",label:"ID",align:"left",field:"id",sortable:!0},{name:"first_name",label:"School Name",align:"left",field:"first_name",sortable:!0},{name:"middle_name",label:"School Number",align:"left",field:"middle_name",sortable:!0},{name:"last_name",label:"Assigned Personnel Full Name",align:"left",field:"last_name",sortable:!0},{name:"email",label:"Email",align:"left",field:"email",sortable:!0},{name:"account_type",label:"Account Type",align:"left",field:"account_type",sortable:!0},{name:"action",label:"Actions",align:"center",field:"action"}],accountTypeOptions:[{label:"Developer",value:1},{label:"Admin",value:2},{label:"Admin Workers",value:3},{label:"School",value:4},{label:"School",value:5},{label:"School",value:6}]}},created(){},computed:{filteredUsers(){return this.filter?this.users.filter(e=>e.first_name.toLowerCase().includes(this.filter.toLowerCase())||e.last_name.toLowerCase().includes(this.filter.toLowerCase())||e.email.toLowerCase().includes(this.filter.toLowerCase())):this.users}},methods:{getAccountTypeName(e){return{1:"Developer",5:"School",6:"School"}[e]||"Unknown"},async fetchUsers(){this.loading=!0;try{const e=localStorage.getItem("access_token"),l=await m.get(`${p}/notValidUsers`,{headers:{Authorization:`Bearer ${e}`},params:{search:this.filter,per_page:this.pagination.rowsPerPage,page:this.pagination.page}});this.users=l.data.data,this.totalPages=l.data.last_page}catch(e){console.error(e)}finally{this.loading=!1}},toggleFilter(){this.show_filter=!this.show_filter},async openEditModal(e){this.editForm={...e},this.editDialog=!0},async confirmDelete(e){this.userToDelete=e,this.deleteDialog=!0},async deleteUser(){try{const e=localStorage.getItem("access_token");await m.delete(`${p}/validUsers/${this.userToDelete.id}`,{headers:{Authorization:`Bearer ${e}`}}),this.deleteDialog=!1,this.fetchUsers(),this.triggerSocketToAdmin("WeHaveANewSignUpAccount")}catch(e){console.error(e)}},triggerSocketToAdmin(e){this.socket.emit("senderTriggerness",e,552)},async confirmAccept(e){this.userToAccept=e,this.acceptDialog=!0},async acceptConfirmedUser(){try{const e=localStorage.getItem("access_token");(await m.post(`${p}/acceptAccount`,{id:this.userToAccept.id},{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})).status===200&&(this.fetchUsers(),this.triggerSocketToAdmin("WeHaveANewSignUpAccount"))}catch(e){console.error(e)}finally{this.acceptDialog=!1}},closeAcceptDialog(){this.acceptDialog=!1},closeDeleteDialog(){this.deleteDialog=!1}},mounted(){this.fetchUsers()}}),S=r("div",{class:"text-h6"},"Pending Users",-1),_={style:{display:"flex","justify-content":"space-between",padding:"10px"}},P=r("div",{class:"text-h6"},"Confirm Delete",-1),$=r("p",null,"Are you sure you want to delete this user?",-1),N=r("div",{class:"text-h6"},"Confirm Accept",-1);function q(e,l,B,I,L,j){return f(),g(D,{padding:""},{default:o(()=>[t(c,{class:"no-shadow",bordered:""},{default:o(()=>[t(i,{class:"header-format-w"},{default:o(()=>[S]),_:1}),t(w),t(i,{class:"q-pa-none"},{default:o(()=>[t(A,{square:"",class:"no-shadow",title:"Users",rows:e.filteredUsers,columns:e.columns,"row-key":"id",filter:e.filter,pagination:e.pagination,"hide-pagination":""},{"top-right":o(()=>[e.show_filter?(f(),g(y,{key:0,filled:"",borderless:"",dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":l[0]||(l[0]=a=>e.filter=a),placeholder:"Search"},{append:o(()=>[t(b,{name:"search"})]),_:1},8,["modelValue"])):T("",!0),t(s,{class:"q-ml-sm",icon:"filter_list",onClick:e.toggleFilter,flat:""},null,8,["onClick"])]),"body-cell-action":o(a=>[t(d,{props:a,class:"q-pa-md q-gutter-sm"},{default:o(()=>[t(s,{label:"Accept",onClick:h=>e.confirmAccept(a.row),color:"secondary"},null,8,["onClick"]),t(s,{label:"Reject",onClick:h=>e.confirmDelete(a.row),color:"negative"},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-account_type":o(a=>[t(d,{props:a},{default:o(()=>[V(n(e.getAccountTypeName(a.row.account_type)),1)]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter","pagination"]),r("div",_,[t(k,{modelValue:e.pagination.page,"onUpdate:modelValue":[l[1]||(l[1]=a=>e.pagination.page=a),e.fetchUsers],max:e.totalPages,"boundary-numbers":"",class:"q-mt-md"},null,8,["modelValue","max","onUpdate:modelValue"]),t(C,{filled:"",modelValue:e.pagination.rowsPerPage,"onUpdate:modelValue":[l[2]||(l[2]=a=>e.pagination.rowsPerPage=a),e.fetchUsers],options:e.rowsPerPageOptions,label:"Rows per page",class:"q-ml-sm",dense:"",style:{width:"200px"}},null,8,["modelValue","options","onUpdate:modelValue"])])]),_:1})]),_:1}),t(u,{modelValue:e.deleteDialog,"onUpdate:modelValue":l[3]||(l[3]=a=>e.deleteDialog=a)},{default:o(()=>[t(c,null,{default:o(()=>[t(i,{class:"header-format-w"},{default:o(()=>[P,$]),_:1}),t(i,null,{default:o(()=>[t(s,{label:"Delete",color:"negative",onClick:e.deleteUser},null,8,["onClick"]),t(s,{label:"Cancel",class:"q-ml-sm",onClick:e.closeDeleteDialog},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(u,{modelValue:e.acceptDialog,"onUpdate:modelValue":l[4]||(l[4]=a=>e.acceptDialog=a)},{default:o(()=>[t(c,null,{default:o(()=>[t(i,{class:"header-format-w"},{default:o(()=>[N,r("p",null,"Are you sure you want to accept "+n(e.userToAccept.first_name)+" "+n(e.userToAccept.middle_name)+" "+n(e.userToAccept.last_name)+"?",1)]),_:1}),t(i,null,{default:o(()=>[t(s,{label:"Accept",color:"secondary",onClick:e.acceptConfirmedUser},null,8,["onClick"]),t(s,{label:"Cancel",class:"q-ml-sm",onClick:e.closeAcceptDialog},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var Te=U(v,[["render",q]]);export{Te as default};
