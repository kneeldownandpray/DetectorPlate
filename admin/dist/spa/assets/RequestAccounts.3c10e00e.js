import{Q as i}from"./QCardSection.a5303736.js";import{Q as b}from"./QSeparator.42367e68.js";import{Q as k}from"./QIcon.bb9750ae.js";import{Q as y}from"./QInput.981afcd1.js";import{Q as s}from"./QBtn.e3ba8fe5.js";import{Q as d}from"./QTd.14a02cb5.js";import{Q as A}from"./QTable.95eb64b4.js";import{Q as C}from"./QPagination.a5839286.js";import{Q as D}from"./QSelect.7fc8bd9c.js";import{Q as c}from"./QCard.e1b4f547.js";import{Q as u}from"./QDialog.d2ec560c.js";import{Q as U}from"./QPage.a4ebaaa8.js";import{a as p}from"./axios.ab682c6b.js";import{_ as Q,j as v,k as f,v as g,m as o,d as t,s as T,t as V,u as n,p as r}from"./index.631e4989.js";import"./render.86f80e41.js";import"./use-dark.94823b81.js";import"./use-size.cb14fd9c.js";import"./use-key-composition.aa95e8e5.js";import"./QSpinner.b32ed815.js";import"./use-id.10a13483.js";import"./uid.937d8ee7.js";import"./focus-manager.7cc6c8df.js";import"./private.use-form.81eb29f1.js";import"./dom.743d1640.js";import"./use-router-link.6338664c.js";import"./vm.bd5b438f.js";import"./QList.5dcbacd3.js";import"./QMarkupTable.88c0e097.js";import"./scroll.5d898aa6.js";import"./QCheckbox.71e3c128.js";import"./format.2cae61da.js";import"./QChip.e5d8ec81.js";import"./QItem.439b04aa.js";import"./QItemLabel.30bae559.js";import"./position-engine.6ae81e1d.js";import"./selection.292370fb.js";import"./use-portal.0a348834.js";import"./use-tick.dfdf9b07.js";import"./use-timeout.081b347b.js";import"./rtl.276c3f1b.js";import"./use-prevent-scroll.71085d3e.js";const m="https://backend.parkease.online/api",S=v({name:"TableBasic",data(){return{filter:"",show_filter:!1,users:[],loading:!1,deleteDialog:!1,acceptDialog:!1,userToAccept:null,userToDelete:null,rowsPerPageOptions:[5,10],pagination:{rowsPerPage:10,page:1},totalPages:0,columns:[{name:"id",label:"ID",align:"left",field:"id",sortable:!0},{name:"first_name",label:"School Name",align:"left",field:"first_name",sortable:!0},{name:"middle_name",label:"School Number",align:"left",field:"middle_name",sortable:!0},{name:"last_name",label:"Assigned Personnel Full Name",align:"left",field:"last_name",sortable:!0},{name:"email",label:"Email",align:"left",field:"email",sortable:!0},{name:"account_type",label:"Account Type",align:"left",field:"account_type",sortable:!0},{name:"action",label:"Actions",align:"center",field:"action"}],accountTypeOptions:[{label:"Developer",value:1},{label:"Admin",value:2},{label:"Admin Workers",value:3},{label:"School",value:4},{label:"School",value:5},{label:"School",value:6}]}},created(){const e="https://realtime.parkease.online";this.socket=io(e),this.socket.on("receiverTriggerness",(a,h)=>{a=="WeHaveANewSignUpAccount"&&this.fetchUsers()})},computed:{filteredUsers(){return this.filter?this.users.filter(e=>e.first_name.toLowerCase().includes(this.filter.toLowerCase())||e.last_name.toLowerCase().includes(this.filter.toLowerCase())||e.email.toLowerCase().includes(this.filter.toLowerCase())):this.users}},methods:{getAccountTypeName(e){return{1:"Developer",5:"School",6:"School"}[e]||"Unknown"},async fetchUsers(){this.loading=!0;try{const e=localStorage.getItem("access_token"),a=await p.get(`${m}/notValidUsers`,{headers:{Authorization:`Bearer ${e}`},params:{search:this.filter,per_page:this.pagination.rowsPerPage,page:this.pagination.page}});this.users=a.data.data,this.totalPages=a.data.last_page}catch(e){console.error(e)}finally{this.loading=!1}},toggleFilter(){this.show_filter=!this.show_filter},async openEditModal(e){this.editForm={...e},this.editDialog=!0},async confirmDelete(e){this.userToDelete=e,this.deleteDialog=!0},async deleteUser(){try{const e=localStorage.getItem("access_token");await p.delete(`${m}/validUsers/${this.userToDelete.id}`,{headers:{Authorization:`Bearer ${e}`}}),this.deleteDialog=!1,this.fetchUsers(),this.triggerSocketToAdmin("WeHaveANewSignUpAccount")}catch(e){console.error(e)}},triggerSocketToAdmin(e){this.socket.emit("senderTriggerness",e,552)},async confirmAccept(e){this.userToAccept=e,this.acceptDialog=!0},async acceptConfirmedUser(){try{const e=localStorage.getItem("access_token");(await p.post(`${m}/acceptAccount`,{id:this.userToAccept.id},{headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})).status===200&&(this.fetchUsers(),this.triggerSocketToAdmin("WeHaveANewSignUpAccount"))}catch(e){console.error(e)}finally{this.acceptDialog=!1}},closeAcceptDialog(){this.acceptDialog=!1},closeDeleteDialog(){this.deleteDialog=!1}},mounted(){this.fetchUsers()}}),_=r("div",{class:"text-h6"},"Pending Users",-1),P={style:{display:"flex","justify-content":"space-between",padding:"10px"}},$=r("div",{class:"text-h6"},"Confirm Delete",-1),N=r("p",null,"Are you sure you want to delete this user?",-1),q=r("div",{class:"text-h6"},"Confirm Accept",-1);function B(e,a,h,I,L,j){return f(),g(U,{padding:""},{default:o(()=>[t(c,{class:"no-shadow",bordered:""},{default:o(()=>[t(i,{class:"header-format-w"},{default:o(()=>[_]),_:1}),t(b),t(i,{class:"q-pa-none"},{default:o(()=>[t(A,{square:"",class:"no-shadow",title:"Users",rows:e.filteredUsers,columns:e.columns,"row-key":"id",filter:e.filter,pagination:e.pagination,"hide-pagination":""},{"top-right":o(()=>[e.show_filter?(f(),g(y,{key:0,filled:"",borderless:"",dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":a[0]||(a[0]=l=>e.filter=l),placeholder:"Search"},{append:o(()=>[t(k,{name:"search"})]),_:1},8,["modelValue"])):T("",!0),t(s,{class:"q-ml-sm",icon:"filter_list",onClick:e.toggleFilter,flat:""},null,8,["onClick"])]),"body-cell-action":o(l=>[t(d,{props:l,class:"q-pa-md q-gutter-sm"},{default:o(()=>[t(s,{label:"Accept",onClick:w=>e.confirmAccept(l.row),color:"secondary"},null,8,["onClick"]),t(s,{label:"Reject",onClick:w=>e.confirmDelete(l.row),color:"negative"},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-account_type":o(l=>[t(d,{props:l},{default:o(()=>[V(n(e.getAccountTypeName(l.row.account_type)),1)]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter","pagination"]),r("div",P,[t(C,{modelValue:e.pagination.page,"onUpdate:modelValue":[a[1]||(a[1]=l=>e.pagination.page=l),e.fetchUsers],max:e.totalPages,"boundary-numbers":"",class:"q-mt-md"},null,8,["modelValue","max","onUpdate:modelValue"]),t(D,{filled:"",modelValue:e.pagination.rowsPerPage,"onUpdate:modelValue":[a[2]||(a[2]=l=>e.pagination.rowsPerPage=l),e.fetchUsers],options:e.rowsPerPageOptions,label:"Rows per page",class:"q-ml-sm",dense:"",style:{width:"200px"}},null,8,["modelValue","options","onUpdate:modelValue"])])]),_:1})]),_:1}),t(u,{modelValue:e.deleteDialog,"onUpdate:modelValue":a[3]||(a[3]=l=>e.deleteDialog=l)},{default:o(()=>[t(c,null,{default:o(()=>[t(i,{class:"header-format-w"},{default:o(()=>[$,N]),_:1}),t(i,null,{default:o(()=>[t(s,{label:"Delete",color:"negative",onClick:e.deleteUser},null,8,["onClick"]),t(s,{label:"Cancel",class:"q-ml-sm",onClick:e.closeDeleteDialog},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(u,{modelValue:e.acceptDialog,"onUpdate:modelValue":a[4]||(a[4]=l=>e.acceptDialog=l)},{default:o(()=>[t(c,null,{default:o(()=>[t(i,{class:"header-format-w"},{default:o(()=>[q,r("p",null,"Are you sure you want to accept "+n(e.userToAccept.first_name)+" "+n(e.userToAccept.middle_name)+" "+n(e.userToAccept.last_name)+"?",1)]),_:1}),t(i,null,{default:o(()=>[t(s,{label:"Accept",color:"secondary",onClick:e.acceptConfirmedUser},null,8,["onClick"]),t(s,{label:"Cancel",class:"q-ml-sm",onClick:e.closeAcceptDialog},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var ve=Q(S,[["render",B]]);export{ve as default};
