import{Q as y}from"./QIcon.6a1c506e.js";import{Q as i}from"./QCardSection.d27bd26a.js";import{Q as D}from"./QSeparator.1b7512a0.js";import{Q as t}from"./QBtn.ff85a6ff.js";import{Q as s}from"./QInput.62618fbe.js";import{Q as F}from"./QTd.5a66afdc.js";import{Q as v}from"./QTable.9d9784b4.js";import{Q}from"./QPagination.edf7b580.js";import{Q as p}from"./QSelect.71279283.js";import{Q as d}from"./QCard.c79eb86a.js";import{Q as f}from"./QForm.d36385cb.js";import{Q as g}from"./QDialog.c9516741.js";import{Q as S}from"./QCardActions.c693319c.js";import{Q as q}from"./QPage.cd4eeac7.js";import{_ as A,j as $,k as U,v as P,m as r,d as a,p as n,t as C,s as N,u as T,aw as w}from"./index.ccc655a8.js";import{a as m}from"./axios.ab682c6b.js";import"./use-size.e5fcccbb.js";import"./render.31dc14a1.js";import"./use-dark.fcf957f9.js";import"./QSpinner.ad1652ab.js";import"./dom.ab32582f.js";import"./use-router-link.f3c58062.js";import"./vm.bd5b438f.js";import"./use-key-composition.b73995f7.js";import"./use-id.51f80acb.js";import"./uid.937d8ee7.js";import"./focus-manager.7cc6c8df.js";import"./private.use-form.bf143076.js";import"./QList.3fa3315d.js";import"./QMarkupTable.7a11d5f7.js";import"./scroll.3a45a3c7.js";import"./QCheckbox.5aa928a9.js";import"./format.2cae61da.js";import"./QChip.44a8527b.js";import"./QItem.79ca4c2d.js";import"./QItemLabel.c51f45b8.js";import"./position-engine.e628e528.js";import"./selection.1b9d0d65.js";import"./use-portal.887f479b.js";import"./use-tick.280905b1.js";import"./use-timeout.1142a48a.js";import"./rtl.276c3f1b.js";import"./use-prevent-scroll.89277a0f.js";const u="https://backend.parkease.online/api",B=$({name:"TableBasic",data(){return{filter:"",show_filter:!1,users:[],loading:!1,editDialog:!1,deleteDialog:!1,changePasswordDialog:!1,userToChangePassword:null,showForm:!1,registerForm:{first_name:"",last_name:"",middle_name:"",birthday:"",gender:"",age:"",account_type:"",address:"",email:"",password:"",password_confirmation:""},errors:{},editForm:{id:null,first_name:"",last_name:"",email:"",account_type:1},passwordForm:{new_password:"",new_password_confirmation:""},rowsPerPageOptions:[5,10],pagination:{rowsPerPage:10,page:1},totalPages:0,columns:[{name:"id",label:"ID",align:"left",field:"id",sortable:!0},{name:"first_name",label:"School Name",align:"left",field:"first_name",sortable:!0},{name:"middle_name",label:"School Number",align:"left",field:"middle_name",sortable:!0},{name:"last_name",label:"Assigned Personnel Full Name",align:"left",field:"last_name",sortable:!0},{name:"email",label:"Email",align:"left",field:"email",sortable:!0},{name:"account_type",label:"Account Type",align:"left",field:"account_type",sortable:!0},{name:"action",label:"Actions",align:"center",field:"action"}],accountTypeOptions:[{label:"School Account",value:6}],genderOptions:[{label:"Male",value:"male"},{label:"Female",value:"female"},{label:"Unknown",value:"unknown"}]}},computed:{filteredUsers(){return this.filter?this.users.filter(e=>e.first_name.toLowerCase().includes(this.filter.toLowerCase())||e.last_name.toLowerCase().includes(this.filter.toLowerCase())||e.email.toLowerCase().includes(this.filter.toLowerCase())):this.users}},methods:{async registerUser(){var e;this.loading=!0;try{const l=localStorage.getItem("access_token"),h=this.registerForm.account_type.value,c=this.registerForm.gender.value;this.registerForm.account_type=h,this.registerForm.gender=c;const V=this.registerForm,k=await m.post(`${u}/register`,V,{headers:{Authorization:`Bearer ${l}`}})}catch(l){console.error("Error during registration:",((e=l.response)==null?void 0:e.data)||l.message)}finally{this.loading=!1,this.resetForm(),this.showForm=!1}},resetForm(){this.registerForm={first_name:"",last_name:"",middle_name:"",birthday:"",gender:"",age:"",account_type:"",address:"",email:"",password:"",password_confirmation:""},this.errors={}},getAccountTypeName(e){return{6:"School"}[e]||"Unknown"},async fetchUsers(){this.loading=!0;try{const e=localStorage.getItem("access_token"),l=await m.get(`${u}/validUsers`,{headers:{Authorization:`Bearer ${e}`},params:{search:this.filter,per_page:this.pagination.rowsPerPage,page:this.pagination.page,account_type:6}});this.users=l.data.data,this.totalPages=l.data.last_page}catch(e){console.error(e)}finally{this.loading=!1}},toggleFilter(){this.show_filter=!this.show_filter},async openEditModal(e){this.editForm={...e},this.editDialog=!0},async updateUser(){try{const e=localStorage.getItem("access_token");await m.put(`${u}/validUsers/${this.editForm.id}`,this.editForm,{headers:{Authorization:`Bearer ${e}`}}),this.editDialog=!1,this.fetchUsers()}catch(e){console.error(e)}},openChangePasswordModal(e){this.passwordForm.new_password=null,this.passwordForm.new_password_confirmation=null,this.userToChangePassword=e,this.changePasswordDialog=!0},async changePassword(){try{const e=localStorage.getItem("access_token");await m.put(`${u}/validUsers/${this.userToChangePassword.id}/changePassword`,{new_password:this.passwordForm.new_password,new_password_confirmation:this.passwordForm.new_password_confirmation},{headers:{Authorization:`Bearer ${e}`}}),this.changePasswordDialog=!1}catch(e){console.error(e)}},async confirmDelete(e){this.userToDelete=e,this.deleteDialog=!0},async deleteUser(){try{const e=localStorage.getItem("access_token");await m.delete(`${u}/validUsers/${this.userToDelete.id}`,{headers:{Authorization:`Bearer ${e}`}}),this.deleteDialog=!1,this.fetchUsers()}catch(e){console.error(e)}},closeEditModal(){this.editDialog=!1},closeChangePasswordModal(){this.changePasswordDialog=!1},closeDeleteDialog(){this.deleteDialog=!1}},mounted(){this.fetchUsers()}}),E={class:"text-h6"},M={style:{display:"flex","justify-content":"space-between",padding:"10px"}},I=n("div",{class:"text-h6"},"Edit User",-1),L=n("div",{class:"text-h6"},"Register New Account",-1),O=n("div",{class:"text-h6"},"Change Password",-1),z=n("div",{class:"text-h6"},"Confirm Delete",-1),R=n("p",null,"Are you sure you want to delete this user?",-1);function j(e,l,h,c,V,k){return U(),P(q,{padding:""},{default:r(()=>[a(d,{class:"no-shadow",bordered:""},{default:r(()=>[a(i,{class:"header-format-w"},{default:r(()=>[n("div",E,[a(y,{name:"person",size:"25px",class:"q-mr-sm"}),C("School Account")])]),_:1}),a(D),a(i,{class:"q-pa-none"},{default:r(()=>[a(v,{square:"",class:"no-shadow",title:"Users",rows:e.filteredUsers,columns:e.columns,"row-key":"id",filter:e.filter,pagination:e.pagination,"hide-pagination":""},{"top-right":r(()=>[a(t,{label:"Add Account",color:"primary",class:"q-mr-sm",onClick:l[0]||(l[0]=o=>e.showForm=!0)}),e.show_filter?(U(),P(s,{key:0,filled:"",borderless:"",dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":l[1]||(l[1]=o=>e.filter=o),placeholder:"Search"},{append:r(()=>[a(y,{name:"search"})]),_:1},8,["modelValue"])):N("",!0),a(t,{class:"q-ml-sm",icon:"filter_list",onClick:e.toggleFilter,flat:""},null,8,["onClick"])]),"body-cell-action":r(o=>[a(F,{props:o},{default:r(()=>[a(t,{flat:"",icon:"edit",onClick:b=>e.openEditModal(o.row)},null,8,["onClick"]),a(t,{flat:"",icon:"lock",onClick:b=>e.openChangePasswordModal(o.row)},null,8,["onClick"]),a(t,{flat:"",icon:"delete",onClick:b=>e.confirmDelete(o.row),color:"negative"},null,8,["onClick"])]),_:2},1032,["props"])]),"body-cell-account_type":r(o=>[a(F,{props:o},{default:r(()=>[C(T(e.getAccountTypeName(o.row.account_type)),1)]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter","pagination"]),n("div",M,[a(Q,{modelValue:e.pagination.page,"onUpdate:modelValue":[l[2]||(l[2]=o=>e.pagination.page=o),e.fetchUsers],max:e.totalPages,"boundary-numbers":"",class:"q-mt-md"},null,8,["modelValue","max","onUpdate:modelValue"]),a(p,{filled:"",modelValue:e.pagination.rowsPerPage,"onUpdate:modelValue":[l[3]||(l[3]=o=>e.pagination.rowsPerPage=o),e.fetchUsers],options:e.rowsPerPageOptions,label:"Rows per page",class:"q-ml-sm",dense:"",style:{width:"200px"}},null,8,["modelValue","options","onUpdate:modelValue"])])]),_:1})]),_:1}),a(g,{modelValue:e.editDialog,"onUpdate:modelValue":l[8]||(l[8]=o=>e.editDialog=o)},{default:r(()=>[a(d,{class:"custom-dialog"},{default:r(()=>[a(i,{class:"header-format-w"},{default:r(()=>[I]),_:1}),a(i,null,{default:r(()=>[a(f,{onSubmit:w(e.updateUser,["prevent"])},{default:r(()=>[a(s,{modelValue:e.editForm.first_name,"onUpdate:modelValue":l[4]||(l[4]=o=>e.editForm.first_name=o),label:"School Name",required:""},null,8,["modelValue"]),a(s,{modelValue:e.editForm.last_name,"onUpdate:modelValue":l[5]||(l[5]=o=>e.editForm.last_name=o),label:"Assigned Personel Name",required:""},null,8,["modelValue"]),a(s,{modelValue:e.editForm.email,"onUpdate:modelValue":l[6]||(l[6]=o=>e.editForm.email=o),label:"Email",type:"email",required:""},null,8,["modelValue"]),a(p,{modelValue:e.editForm.account_type,"onUpdate:modelValue":l[7]||(l[7]=o=>e.editForm.account_type=o),options:e.accountTypeOptions,label:"Account Type",required:""},null,8,["modelValue","options"]),a(t,{type:"submit",label:"Save",color:"primary",class:"q-mt-md"}),a(t,{label:"Cancel",class:"q-ml-sm q-mt-md",onClick:e.closeEditModal},null,8,["onClick"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(g,{modelValue:e.showForm,"onUpdate:modelValue":l[21]||(l[21]=o=>e.showForm=o),persistent:""},{default:r(()=>[a(d,{class:"custom-dialog"},{default:r(()=>[a(i,{class:"header-format-w"},{default:r(()=>[L]),_:1}),a(f,{onSubmit:w(e.registerUser,["prevent"])},{default:r(()=>[a(i,null,{default:r(()=>[a(s,{filled:"",modelValue:e.registerForm.first_name,"onUpdate:modelValue":l[9]||(l[9]=o=>e.registerForm.first_name=o),label:"School Name",error:e.errors.first_name,rules:[o=>!!o||"First Name is required"]},null,8,["modelValue","error","rules"]),a(s,{filled:"",modelValue:e.registerForm.last_name,"onUpdate:modelValue":l[10]||(l[10]=o=>e.registerForm.last_name=o),label:"Assigned Personel Name",error:e.errors.last_name,rules:[o=>!!o||"Last Name is required"]},null,8,["modelValue","error","rules"]),a(s,{filled:"",modelValue:e.registerForm.middle_name,"onUpdate:modelValue":l[11]||(l[11]=o=>e.registerForm.middle_name=o),label:"School Number"},null,8,["modelValue"]),a(s,{filled:"",modelValue:e.registerForm.birthday,"onUpdate:modelValue":l[12]||(l[12]=o=>e.registerForm.birthday=o),label:"Birthday",type:"date"},null,8,["modelValue"]),a(p,{filled:"",modelValue:e.registerForm.gender,"onUpdate:modelValue":l[13]||(l[13]=o=>e.registerForm.gender=o),options:e.genderOptions,label:"Gender"},null,8,["modelValue","options"]),a(s,{filled:"",modelValue:e.registerForm.age,"onUpdate:modelValue":l[14]||(l[14]=o=>e.registerForm.age=o),label:"Age",type:"number"},null,8,["modelValue"]),a(p,{filled:"",modelValue:e.registerForm.account_type,"onUpdate:modelValue":l[15]||(l[15]=o=>e.registerForm.account_type=o),options:e.accountTypeOptions,label:"Account Type"},null,8,["modelValue","options"]),a(s,{filled:"",modelValue:e.registerForm.address,"onUpdate:modelValue":l[16]||(l[16]=o=>e.registerForm.address=o),label:"Address"},null,8,["modelValue"]),a(s,{filled:"",modelValue:e.registerForm.email,"onUpdate:modelValue":l[17]||(l[17]=o=>e.registerForm.email=o),label:"Email",type:"email",rules:[o=>!!o||"Email is required"]},null,8,["modelValue","rules"]),a(s,{filled:"",modelValue:e.registerForm.password,"onUpdate:modelValue":l[18]||(l[18]=o=>e.registerForm.password=o),label:"Password",type:"password",rules:[o=>!!o||"Password is required"]},null,8,["modelValue","rules"]),a(s,{filled:"",modelValue:e.registerForm.password_confirmation,"onUpdate:modelValue":l[19]||(l[19]=o=>e.registerForm.password_confirmation=o),label:"Confirm Password",type:"password",rules:[o=>o===e.registerForm.password||"Passwords must match"]},null,8,["modelValue","rules"])]),_:1}),a(S,{align:"right"},{default:r(()=>[a(t,{flat:"",label:"Cancel",color:"negative",onClick:l[20]||(l[20]=o=>e.showForm=!1)}),a(t,{type:"submit",label:"Register",color:"primary"})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),a(g,{modelValue:e.changePasswordDialog,"onUpdate:modelValue":l[24]||(l[24]=o=>e.changePasswordDialog=o)},{default:r(()=>[a(d,null,{default:r(()=>[a(i,{class:"header-format-w"},{default:r(()=>[O]),_:1}),a(i,null,{default:r(()=>[a(f,{onSubmit:w(e.changePassword,["prevent"])},{default:r(()=>[a(s,{modelValue:e.passwordForm.new_password,"onUpdate:modelValue":l[22]||(l[22]=o=>e.passwordForm.new_password=o),label:"New Password",type:"password",rules:[o=>o.length>=8||"Password must be at least 8 characters long"],required:""},null,8,["modelValue","rules"]),a(s,{modelValue:e.passwordForm.new_password_confirmation,"onUpdate:modelValue":l[23]||(l[23]=o=>e.passwordForm.new_password_confirmation=o),label:"Confirm New Password",type:"password",rules:[o=>o.length>=8||"Password confirmation must be at least 8 characters long",o=>o===e.passwordForm.new_password||"Passwords do not match"],required:""},null,8,["modelValue","rules"]),a(t,{type:"submit",label:"Change Password",color:"primary",class:"q-mt-md"}),a(t,{label:"Cancel",class:"q-ml-sm q-mt-md",onClick:e.closeChangePasswordModal},null,8,["onClick"])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(g,{modelValue:e.deleteDialog,"onUpdate:modelValue":l[25]||(l[25]=o=>e.deleteDialog=o)},{default:r(()=>[a(d,null,{default:r(()=>[a(i,{class:"header-format-w"},{default:r(()=>[z,R]),_:1}),a(i,null,{default:r(()=>[a(t,{label:"Delete",color:"negative",onClick:e.deleteUser},null,8,["onClick"]),a(t,{label:"Cancel",class:"q-ml-sm",onClick:e.closeDeleteDialog},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var Ne=A(B,[["render",j]]);export{Ne as default};
